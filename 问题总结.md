# Android 16 (API 36) HEIF 图片加载问题笔记
Android 16 以下系统会自动把 HEIF 的 10bit 图降级为 8bit；Android 16 系统开始保留 10bit，导致现有图片加载框架无法识别，需要手动转成 ARGB_8888 才能正常显示。

## 一、现象
- **Android 16 以下（API < 36）**  
  HEIF/HEIC 图片可以正常加载。  

- **Android 16（API = 36）**  
  HEIF/HEIC 图片可能无法显示，表现为 **黑屏或加载失败**。  

---

## 二、原因分析
### Android 16 以下
- 系统 **不支持 10bit Bitmap 配置**（如 `ARGB_1010102`）。  
- 解码 HEIF/HEIC（10bit）时，会 **自动降级为 8bit (`ARGB_8888`)**。  
- 图片加载框架（Glide、Coil、Picasso）默认处理 `ARGB_8888`，因此能正常显示。  

### Android 16
- 系统开始 **原生支持 10bit Bitmap 配置**：  
  - `ARGB_1010102`（10bit 通道）  
  - `RGBA_F16`（16bit float 通道，HDR）  
- 解码 HEIF/HEIC（10bit）时，系统会 **保持原始位深度**。  
- **不会再自动转换为 ARGB_8888**。  
- 导致大多数框架 / 控件不兼容：  
  - `ImageView` 显示黑屏  
  - Glide/Coil 直接报错或返回 null  

---

## 三、根因总结
- **Android 16 以下**：系统自动兼容 → 透明处理为 `ARGB_8888`  
- **Android 16 开始**：系统不再降级 → 直接输出 `ARGB_1010102` → 框架无法处理  

---

## 四、解决方案
### 方案一：强制转成 `ARGB_8888`（兼容性最好）
```kotlin
val safeBitmap = if (bitmap.config != Bitmap.Config.ARGB_8888) {
    bitmap.copy(Bitmap.Config.ARGB_8888, false)
} else {
    bitmap
}
imageView.setImageBitmap(safeBitmap)
